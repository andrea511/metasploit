class CreateNexposeDataVulnerabilityInstances < ActiveRecord::Migration[4.2]
  def change
    create_table :nexpose_data_vulnerability_instances do |t|
      t.string :vulnerability_id
      t.string :asset_id
      t.integer :nexpose_data_vulnerability_id    # Foreign key to our cached asset table
      t.integer :nexpose_data_asset_id            # Foreign key to our cached asset table
      # t.inet :asset_ip_address
      t.string :scan_id
      t.date :date
      t.string :status
      t.text :proof
      t.string :key
      t.string :service
      t.integer :port
      t.string :protocol

      t.timestamps null: false
    end
    add_column :nexpose_data_vulnerability_instances, :asset_ip_address, :inet
    add_index :nexpose_data_vulnerability_instances, [:asset_id, :vulnerability_id],
              :name => "index_nx_data_vuln_inst_on_asset_id_and_vulnerability_id"
    add_index :nexpose_data_vulnerability_instances, [:vulnerability_id, :asset_id],
              :name => "index_nx_data_vuln_inst_on_vulnerability_id_and_asset_id"
    add_index :nexpose_data_vulnerability_instances, :nexpose_data_vulnerability_id,
              :name => "index_nx_data_vuln_inst_on_nexpose_data_vulnerability_id"
    add_index :nexpose_data_vulnerability_instances, :nexpose_data_asset_id,
              :name => "index_nx_data_vuln_inst_on_nexpose_data_asset_id"
  end
end
