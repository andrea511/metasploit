<meta name='steps' content="<%= @steps.map { |s| [s, wizard_path(s)] }.to_json %>" />
<%= semantic_form_for @builder.form,
                      :as => :quick_pentest,
                      :url => wizard_path,
                      :authenticity_token => false,
                      :html => { :class => 'task_config' } do |f|
%>
  <div class='page create_project'>
    <input type='hidden' name='_method' value='PUT' />
    <div id="profile-button-menu">
      <label id='quick_pentest_profile_buttons_input'><span style='padding-right:5px'>Target Profile</span></label><div></div>
      <ul>
        <% Wizards::QuickPentest::Form::QUICK_PENTEST_PROFILE_TYPES.each do |profile| %>
          <%= render :partial => 'shared/quick_start_icon', :locals => { :name => profile[0], :class_name => profile[1], :title => profile[2] } %>
        <% end %>
        <%= f.help_link "profile_buttons" do %>
          <h3>Target Profiles</h3>
          <ul>
            <% Wizards::QuickPentest::Form::QUICK_PENTEST_PROFILE_TYPES.each do |profile| %>
              <li><strong><%= profile[0] %></strong> - <%= profile[2] %>.</li>
            <% end %>
          </ul>
        <% end %>
      </ul>
    </div>
    <hr style='margin-bottom: 22px' />
    <div class='relativer'>
      <%= nested_semantic_fields_for @form.workspace do |workspace| %>
        <%= workspace.input :name, :label => "Project Name", :required => false %>
        <%= workspace.input :boundary, :label => "Target Addresses", :as => :text %>
        <%= workspace.help_link "boundary" do %>
          <h3>Target Addresses</h3>
          <p>You can enter a single IP address, an address range, or a CIDR notation. If there are multiple addresses or address ranges, use a newline to separate each entry.</p>
        <% end %>
      <% end %>
      <div class='row small-options' style='width:80%;margin-left: 20%;padding-left: 20px;'>
        <div class='cell' style='padding-top:3px; width:50%'>
          <%= nested_semantic_fields_for @form.workspace do |workspace| %>
            <%= workspace.input :limit_to_network, :label => "Restrict to network range", :required => false %>
          <% end %>
        </div>
      </div>
      <a href='#' class='advanced' data-toggle-selector='.create_project_advanced'>Advanced</a>
    </div>
    <div class='advanced create_project_advanced' style='margin-top: 5px'>
      <%= nested_semantic_fields_for @form.workspace do |workspace| %>
        <%= workspace.input :description, :as => :text, :label => 'Description' %>
      <% end %>
      <%= nested_semantic_fields_for @form.scan_task do |scan_task| %>
        <%= scan_task.input :blacklist_string, :as => :text, :label => "Excluded Addresses" %>
      <% end %>
      <%= nested_semantic_fields_for @form.workspace do |workspace| %>
        <%= render :partial => 'workspaces/users', :locals => { :f => workspace, :hide_boundary => true, :no_js => true } %>
      <% end %>
    </div>
  </div>
  <div class='page configure_scan'>
    <%= f.input :scan_type, :as => :radio, 
        :collection => Wizards::QuickPentest::Form::QUICK_PENTEST_SCAN_TYPES_FORMATTED %>
    <%= nested_semantic_fields_for @form.scan_task do |scan_task| %>
      <div class='advanced toggle_regular_scan' style='display:block'>
        <div class='discovery_creds'>
          <h4>Discovery Credentials</h4>
          <%= scan_task.input :smb_username, :label => "SMB Username" %>
          <%= scan_task.input :smb_password, :label => "SMB Password", :input_html => {:autocomplete => :off} %>
          <%= scan_task.input :smb_domain, :label => "SMB Domain" %>
        </div>
        <div class='scan'>
          <% if current_user and current_user.admin? %>
            <h4>Scan Options</h4>
            <%= scan_task.input :custom_nmap,          :label => "Custom Nmap arguments" %>
            <%= scan_task.input :ports_extra,          :label => "Additional TCP ports" %>
            <%= scan_task.input :ports_blacklist,      :label => "Excluded TCP ports" %>
            <%= scan_task.input :ports_custom,         :label => "Custom TCP port range" %>
            <%= scan_task.input :portscan_source_port, :label => "Custom TCP source port" %>
            <%= scan_task.input :fast_detect,          :label => "Fast detect: Common TCP ports only", :as => :boolean %>
          <% end %>
        </div>
        <div class='clearfix'></div>
      </div>
      <div class='toggle_import advanced' style='display:none'>
        <%= nested_semantic_fields_for @form.import_task do |import_task| %>
          <%= import_task.input :file, :label => 'Import', :as => :file %>
          <!--<%= import_task.input :blacklist_string, :label => "Exclude Addresses" %>-->
          <%= import_task.input :preserve_hosts,   :label => "Do not change existing hosts", :as => :boolean %>
        <% end %>
      </div>
    <% end %>
  </div>
  <div class='page configure_exploits'>
    <%= f.input :exploit_enabled, :as => :hidden %>
    <%= nested_semantic_fields_for @form.exploit_task do |exploit_task| %>
      <h3 class='enabled'>Exploits are <span class='enabled'>enabled</span></h3>
      <%= exploit_task.input :minimum_rank, :label => "Minimum Rank", :include_blank => false, :as => :select, :collection => ExploitTask::RANKS %>
      <%= exploit_task.help_link "minimum_rank" do %>
        <h3>Minimum Reliability</h3>
        <p>The minimum reliability determines the impact of the exploits will have on a target system and indicates the likelihood that the exploits will disrupt the service. It is recommended that you always use a minimum reliability of great or excellent, which means that the exploits used will not cause a service to become unavailable.</p>
      <% end %>
      <div class='advanced' style='display:block'>
        <div class='right'>
          <h4>Exploit Selection</h4>
          <%= exploit_task.input :whitelist_ports, :label => "Included ports" %>
          <%= exploit_task.input :blacklist_ports, :label => "Excluded ports" %>
          <%= exploit_task.input :filter_by_os, :as => :boolean, :label => "Skip exploits that do not match the OS" %>
          <%= exploit_task.input :filter_by_port, :as => :boolean, :label => "Match exploits based on open ports" %>
          <%= exploit_task.input :filter_by_vuln, :as => :boolean, :label => "Match exploits based on vulnerability references" %>
          <div style='text-align: left'>
            <!--<h4 style='margin-top:10px;'>Password</h4>-->

            <%#= exploit_task.input :reuse_passwords_to_escalate, :as => :boolean, :label => "Reuse passwords to escalate privileges." %>
            <%#= exploit_task.input :guess_passwords_to_escalate, :as => :boolean, :label => "Guess passwords to escalate privileges." %>
            <h4 style='margin-top:10px;'>Evidence</h4>
            <%= f.input :collect_evidence, :as => :boolean %>
            <h4 style='margin-top:10px;'>Sessions</h4>
             <%= exploit_task.input :limit_sessions, :as => :boolean, :label => "Only obtain one session per target" %>
             <%= f.input :cleanup_enabled, :as => :boolean, :label => "Clean up sessions when done" %>
          </div>
        </div>
        <div class='left'>  
          <h4>Target Systems</h4>
          <%= exploit_task.input :blacklist_string, :label => "Excluded addresses", :as => :text %>
          <%= exploit_task.input :ignore_fragile_devices, :label => "Ignore known-fragile devices", :as => :boolean %>
          <h4>Payload Settings</h4>
          <%= exploit_task.input :payload_type, :as => :select, :collection => ExploitTask::PAYLOAD_TYPES %>
          <%= exploit_task.input :connection, :as => :select, :collection => ExploitTask::CONNECTIONS %>
          <%= exploit_task.input :payload_ports, :label => 'Listener Ports' %>
          <%= exploit_task.input :payload_lhost, :label => 'Listener Host' %>
          <% if License.get.supports_macros? %>
            <%= exploit_task.input :macro_name, :include_blank => false, :label => "Auto Launch Macro", :as => :select,
                :collection => [""] + Mdm::Macro.all.map(&:name)  %>
          <% end %>
        </div>
        <div class='clearfix'></div>
      </div>
    <% end %>
  </div>

  <%= render :partial => 'wizards/report_tab',
             :locals => { :f => f,
                          :report => @form.report,
                          :rtypes => report_types_for_quick_pentest
             }
  %>

  <%= f.input :profile, :as => :hidden %>
  <input type='hidden' name='no_files' value='' />
<% end %>
